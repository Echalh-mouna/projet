{% extends 'layouts/base.html' %}

{% block title %} Dashboard {% endblock title %}

{% block stylesheets %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
/* Mets ici tout ton CSS personnalisé */
 body {
                animation: backgroundAnimation 10s infinite alternate;
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                height: 100%;
            }
    
         
            .container {
                margin-top: 50px;
                padding: 20px;
                border-radius: 20px;
                box-shadow: 5 4px 6px rgba(176, 2, 109, 0.758);
                transition: box-shadow 0.3s ease-in-out;
            }
    
            .card {
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                transition: box-shadow 0.3s ease-in-out;
            }
    
            .card:hover {
              border-color: #800080;
                box-shadow: 0 6px 10px rgba(204, 4, 204, 0.691);
            }
    
            .form-group {
                margin-bottom: 25px;
                transition: transform 0.3s ease-in-out;
            }
    
            .form-group:hover {
                transform: translateY(-3px);
            }
    
            .form-group label {
                font-weight: bold;
                color: #6c757d;
                font-size: 16px;
                transition: color 0.3s ease-in-out;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            }
    
            .form-control {
                border-radius: 8px;
                border: 1px solid #d4ceda;
                transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            }
    
            .form-control:focus {
                border-color: #800080;
                box-shadow: 0 0 0 0.2rem rgba(128, 0, 128, 0.25);
            }
    
            .btn-primary {
            padding: 8px 8px; /* Réduire la taille du bouton */
        }
    
        /* Modifier la couleur du bouton pour correspondre au dégradé du fond */
        .btn-primary {
            border-color: transparent; /* Supprimer la bordure */
            color: #ffffff; /* Couleur du texte */
        }
    
        /* Modifier la couleur du bouton au survol */
        .btn-primary:hover {
            background: linear-gradient(to right, #6a007d, #32004d); /* Nouveau dégradé au survol */
            border-color: transparent; /* Supprimer la bordure */
        }
    
            .card-title {
                font-size: 24px;
                animation: titleAnimation 2s infinite alternate; /* animation du titre */
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(192, 3, 170, 0.535);
                opacity: 0; /* rendre le titre invisible initialement */
                transform: translateY(-20px); /* déplacer le titre vers le haut */
                transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            }
    
            @keyframes titleAnimation {
                0% {
                    transform: scale(1);
                }
                100% {
                    transform: scale(1.1);
                }
            }
    
            .card-title.show {
                opacity: 1; /* rendre le titre visible */
                transform: translateY(0); /* rétablir la position du titre */
            }
    
            #result {
                margin-top: 20px;
            }
</style>
{% endblock stylesheets %}

{% block content %}
<!-- Dashboard cards ici ... -->

<div class="container" style="margin-top: 50px;">
    <div class="card">
        <h3 class="card-title text-center">Service de Prédiction</h3>
        <form id="prediction-form" action="/predict" method="POST">
            <!-- Tous tes champs ici -->
             <div class="form-group">
                        <label for="Unnamed: 0">Unnamed: 0</label>
                        <input type="number" class="form-control" id="Unnamed: 0" name="Unnamed: 0" required>
                    </div>
                    <div class="form-group">
                        <label for="Source Port">Source Port</label>
                        <input type="number" class="form-control" id="Source Port" name="Source Port" required>
                    </div>
                    <div class="form-group">
                        <label for="Destination Port">Destination Port</label>
                        <input type="number" class="form-control" id="Destination Port" name="Destination Port" required>
                    </div>
                    <div class="form-group">
                        <label for="Protocol">Protocol</label>
                        <input type="number" class="form-control" id="Protocol" name="Protocol" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow Duration">Flow Duration</label>
                        <input type="number" class="form-control" id="Flow Duration" name="Flow Duration" required>
                    </div>
                    <div class="form-group">
                        <label for="Total Fwd Packets">Total Fwd Packets</label>
                        <input type="number" class="form-control" id="Total Fwd Packets" name="Total Fwd Packets" required>
                    </div>
                    <div class="form-group">
                        <label for="Total Backward Packets">Total Backward Packets</label>
                        <input type="number" class="form-control" id="Total Backward Packets" name="Total Backward Packets" required>
                    </div>
                    <div class="form-group">
                        <label for="Total Length of Fwd Packets">Total Length of Fwd Packets</label>
                        <input type="number" class="form-control" id="Total Length of Fwd Packets" name="Total Length of Fwd Packets" required>
                    </div>
                    <div class="form-group">
                        <label for="Total Length of Bwd Packets">Total Length of Bwd Packets</label>
                        <input type="number" class="form-control" id="Total Length of Bwd Packets" name="Total Length of Bwd Packets" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd Packet Length Max">Fwd Packet Length Max</label>
                        <input type="number" class="form-control" id="Fwd Packet Length Max" name="Fwd Packet Length Max" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd Packet Length Min">Fwd Packet Length Min</label>
                        <input type="number" class="form-control" id="Fwd Packet Length Min" name="Fwd Packet Length Min" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd Packet Length Mean">Fwd Packet Length Mean</label>
                        <input type="number" class="form-control" id="Fwd Packet Length Mean" name="Fwd Packet Length Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd Packet Length Std">Fwd Packet Length Std</label>
                        <input type="number" class="form-control" id="Fwd Packet Length Std" name="Fwd Packet Length Std" required>
                    </div>
                    <div class="form-group">
                        <label for="Bwd Packet Length Max">Bwd Packet Length Max</label>
                        <input type="number" class="form-control" id="Bwd Packet Length Max" name="Bwd Packet Length Max" required>
                    </div>
                    <div class="form-group">
                        <label for="Bwd Packet Length Min">Bwd Packet Length Min</label>
                        <input type="number" class="form-control" id="Bwd Packet Length Min" name="Bwd Packet Length Min" required>
                    </div>
                    <div class="form-group">
                        <label for="Bwd Packet Length Mean">Bwd Packet Length Mean</label>
                        <input type="number" class="form-control" id="Bwd Packet Length Mean" name="Bwd Packet Length Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="Bwd Packet Length Std">Bwd Packet Length Std</label>
                        <input type="number" class="form-control" id="Bwd Packet Length Std" name="Bwd Packet Length Std" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow Bytes/s">Flow Bytes/s</label>
                        <input type="number" class="form-control" id="Flow Bytes/s" name="Flow Bytes/s" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow Packets/s">Flow Packets/s</label>
                        <input type="number" class="form-control" id="Flow Packets/s" name="Flow Packets/s" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow IAT Mean">Flow IAT Mean</label>
                        <input type="number" class="form-control" id="Flow IAT Mean" name="Flow IAT Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow IAT Std">Flow IAT Std</label>
                        <input type="number" class="form-control" id="Flow IAT Std" name="Flow IAT Std" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow IAT Max">Flow IAT Max</label>
                        <input type="number" class="form-control" id="Flow IAT Max" name="Flow IAT Max" required>
                    </div>
                    <div class="form-group">
                        <label for="Flow IAT Min">Flow IAT Min</label>
                        <input type="number" class="form-control" id="Flow IAT Min" name="Flow IAT Min" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd IAT Total">Fwd IAT Total</label>
                        <input type="number" class="form-control" id="Fwd IAT Total" name="Fwd IAT Total" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd IAT Mean">Fwd IAT Mean</label>
                        <input type="number" class="form-control" id="Fwd IAT Mean" name="Fwd IAT Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd IAT Std">Fwd IAT Std</label>
                        <input type="number" class="form-control" id="Fwd IAT Std" name="Fwd IAT Std" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd IAT Max">Fwd IAT Max</label>
                        <input type="number" class="form-control" id="Fwd IAT Max" name="Fwd IAT Max" required>
                    </div>
                    <div class="form-group">
                        <label for="Fwd IAT Min">Fwd IAT Min</label>
                            <input type="number" class="form-control" id="Fwd IAT Min" name="Fwd IAT Min" required>
                            
                            </div>
                            <div class="form-group">
                                <label for="Bwd IAT Total">Bwd IAT Total</label>
                                <input type="number" class="form-control" id="Bwd IAT Total" name="Bwd IAT Total" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd IAT Mean">Bwd IAT Mean</label>
                                <input type="number" class="form-control" id="Bwd IAT Mean" name="Bwd IAT Mean" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd IAT Std">Bwd IAT Std</label>
                                <input type="number" class="form-control" id="Bwd IAT Std" name="Bwd IAT Std" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd IAT Max">Bwd IAT Max</label>
                                <input type="number" class="form-control" id="Bwd IAT Max" name="Bwd IAT Max" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd IAT Min">Bwd IAT Min</label>
                                <input type="number" class="form-control" id="Bwd IAT Min" name="Bwd IAT Min" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd Header Length">Bwd Header Length</label>
                                <input type="number" class="form-control" id="Bwd Header Length" name="Bwd Header Length" required>
                            </div>
                            <div class="form-group">
                                <label for="Fwd Packets/s">Fwd Packets/s</label>
                                <input type="number" class="form-control" id="Fwd Packets/s" name="Fwd Packets/s" required>
                            </div>
                            <div class="form-group">
                                <label for="Bwd Packets/s">Bwd Packets/s</label>
                                <input type="number" class="form-control" id="Bwd Packets/s" name="Bwd Packets/s" required>
                            </div>
                            <div class="form-group">
                                <label for="Min Packet Length">Min Packet Length</label>
                                <input type="number" class="form-control" id="Min Packet Length" name="Min Packet Length" required>
                            </div>
                            <div class="form-group">
                                <label for="Max Packet Length">Max Packet Length</label>
                                <input type="number" class="form-control" id="Max Packet Length" name="Max Packet Length" required>
                            </div>
                            <div class="form-group">
                                <label for="Packet Length Mean">Packet Length Mean</label>
                                <input type="number" class="form-control" id="Packet Length Mean" name="Packet Length Mean" required>
                            </div>
                            <div class="form-group">
                                <label for="Packet Length Std">Packet Length Std</label>
                                <input type="number" class="form-control" id="Packet Length Std" name="Packet Length Std" required>
                            </div>
                            <div class="form-group">
                                <label for="Packet Length Variance">Packet Length Variance</label>
                                <input type="number" class="form-control" id="Packet Length Variance" name="Packet Length Variance" required>
                            </div>
                            <div class="form-group">
                                <label for="Average Packet Size">Average Packet Size</label>
                                <input type="number" class="form-control" id="Average Packet Size" name="Average Packet Size" required>
                            </div>
                            <div class="form-group">
                                <label for="Avg Fwd Segment Size">Avg Fwd Segment Size</label>
                                <input type="number" class="form-control" id="Avg Fwd Segment Size" name="Avg Fwd Segment Size" required>
                            </div>
                            <div class="form-group">
                                <label for="Avg Bwd Segment Size">Avg Bwd Segment Size</label>
                                <input type="number" class="form-control" id="Avg Bwd Segment Size" name="Avg Bwd Segment Size" required>
                            </div>
                            <div class="form-group">
                                <label for="Subflow Fwd Packets">Subflow Fwd Packets</label>
                                <input type="number" class="form-control" id="Subflow Fwd Packets" name="Subflow Fwd Packets" required>
                            </div>
                            <div class="form-group">
                                <label for="Subflow Fwd Bytes">Subflow Fwd Bytes</label>
                                <input type="number" class="form-control" id="Subflow Fwd Bytes" name="Subflow Fwd Bytes" required>
                            </div>
                            <div class="form-group">
                                <label for="Subflow Bwd Packets">Subflow Bwd Packets</label>
                                <input type="number" class="form-control" id="Subflow Bwd Packets" name="Subflow Bwd Packets" required>
                            </div>
                            <div class="form-group">
                                <label for="Subflow Bwd Bytes">Subflow Bwd Bytes</label>
                                <input type="number" class="form-control" id="Subflow Bwd Bytes" name="Subflow Bwd Bytes" required>
                            </div>
                            <div class="form-group">
                                <label for="Init Fwd Win Byts">Init Fwd Win Byts</label>
                                <input type="number" class="form-control" id="Init Fwd Win Byts" name="Init Fwd Win Byts" required>
                            </div>
                            <div class="form-group">
                                <label for="Init Bwd Win Byts">Init Bwd Win Byts</label>
                                <input type="number" class="form-control" id="Init Bwd Win Byts" name="Init Bwd Win Byts" required>
                            </div>
                            <div class="form-group">
                                <label for="Fwd Act Data Pkts">Fwd Act Data Pkts</label>
                                <input type="number" class="form-control" id="Fwd Act Data Pkts" name="Fwd Act Data Pkts" required>
                            </div>
                            <div class="form-group">
                                <label for="Fwd Seg Size Min">Fwd Seg Size Min</label>
                                <input type="number" class="form-control" id="Fwd Seg Size Min" name="Fwd Seg Size Min" required>
                            </div>
                            <div class="form-group">
                                <label for="Active Mean">Active Mean</label>
                                <input type="number" class="form-control" id="Active Mean" name="Active Mean" required>
                            </div>
                            <div class="form-group">
                                <label for="Active Std">Active Std</label>
                                <input type="number" class="form-control" id="Active Std" name="Active Std" required>
                            </div>
                            <div class="form-group">
                                <label for="Active Max">Active Max</label>
                                <input type="number" class="form-control" id="Active Max" name="Active Max" required>
                                
                                </div>
                                <div class="form-group">
                                    <label for="Active Min">Active Min</label>
                                    <input type="number" class="form-control" id="Active Min" name="Active Min" required>
                                </div>
                                <div class="form-group">
                                    <label for="Idle Mean">Idle Mean</label>
                                    <input type="number" class="form-control" id="Idle Mean" name="Idle Mean" required>
                                </div>
                                <div class="form-group">
                                    <label for="Idle Std">Idle Std</label>
                                    <input type="number" class="form-control" id="Idle Std" name="Idle Std" required>
                                </div>
                                <div class="form-group">
                                    <label for="Idle Max">Idle Max</label>
                                    <input type="number" class="form-control" id="Idle Max" name="Idle Max" required>
                                </div>
                                <div class="form-group">
                                    <label for="Idle Min">Idle Min</label>
                                    <input type="number" class="form-control" id="Idle Min" name="Idle Min" required>
                                </div>
            <button type="submit" class="btn btn-primary btn-block">Prédire</button>
            
        </form>
        <div class="form-group mt-3">
            <label for="csvInput">Charger un fichier CSV</label>
            <input type="file" id="csvInput" class="form-control" accept=".csv">
        </div>
        <div id="result" class="mt-4"></div>
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('csvInput').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (event) {
            const content = event.target.result.trim();
            const values = content.split(',');
            if (values.length !== 58) {
                alert("Le fichier doit contenir exactement 58 valeurs.");
                return;
            }
            const form = document.getElementById('prediction-form');
            const inputs = form.querySelectorAll("input[type='number']");
            if (inputs.length !== 58) {
                alert("Le formulaire ne contient pas exactement 58 champs.");
                return;
            }
            inputs.forEach((input) => {
                input.removeAttribute("required");
            });
            inputs.forEach((input, index) => {
                input.value = values[index];
                if (input.value === "" || input.value === undefined) {
                    console.warn(`Champ ${index} non rempli ! Valeur CSV: "${values[index]}"`);
                }
            });
            form.noValidate = true;
            // NE PAS soumettre automatiquement
            alert("Champs remplis depuis le CSV. Cliquez sur 'Prédire' pour envoyer.");
        };
        reader.readAsText(file);
    });

    $('#prediction-form').on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: '/predict',
            data: $('#prediction-form').serialize(),
            success: function (response) {
                $('#result').html('<div class="alert alert-success">Prédiction: ' + response.prediction + '</div>');
            },
            error: function (error) {
                $('#result').html('<div class="alert alert-danger">Erreur: ' + (error.responseJSON ? error.responseJSON.error : 'Erreur inconnue') + '</div>');
            }
        });
    });
});
</script>
{% endblock javascripts %}